{% extends "base.html" %}
{% block content %}
<h1>Retrain Model</h1>
<div style="padding: 20px;">
    <div class="info">
        <p><strong>Last Model Training:</strong> {{ last_trained }}</p>
        <p><strong>Images Used for Training:</strong> {{ images_used }}</p>
        <p><strong>Current Number of Images in Dataset:</strong> {{ current_dataset_images }}</p>
    </div>
    <h2>Retraining Status:</h2>
    <p>Retraining: <span id="retraining-status">{{ retraining_status.retraining }}</span></p>
    {% if retraining_status.error %}
        <p style="color:red;">Error: {{ retraining_status.error }}</p>
    {% endif %}
    <pre id="retraining-output" style="background-color:#f4f4f4; padding:10px; border:1px solid #ddd; height:300px; overflow:auto;color:black;">
    {{ retraining_status.output }}
    </pre>
    
    <!-- Add input fields for training parameters -->
    <form action="{{ url_for('retrain_model') }}" method="post">
        <label for="epochs">Epochs:</label>
        <input type="number" id="epochs" name="epochs" value="10" min="1" required><br><br>
        
        <label for="fine_tune_epochs">Fine-tuning Epochs:</label>
        <input type="number" id="fine_tune_epochs" name="fine_tune_epochs" value="10" min="0" required><br><br>
        
        <label for="learning_rate">Learning Rate:</label>
        <input type="number" id="learning_rate" name="learning_rate" value="0.001" step="0.0001" required><br><br>
        
        <label for="fine_tune_at">Unfreeze Layers From:</label>
        <input type="number" id="fine_tune_at" name="fine_tune_at" value="150" min="0" required><br><br>
        
        <button type="submit">Retrain Model</button>
    </form>
</div>

<h1>Model Performance Overview</h1>
<div class="section">
    <h2>Classification Report</h2>
    <iframe src="{{ url_for('static', filename='reports/classification_report.html') }}" width="100%" height="500px" title="iframeReport" style="border-width:0px"></iframe>
</div>
<div class="section">
    <h2>Confusion Matrix</h2>
    <img class="img-report" src="{{ url_for('static', filename='reports/images/confusion_matrix.png') }}" alt="Confusion Matrix">
</div>
<div class="section">
    <h2>Accuracy Over Epochs</h2>
    <img class="img-report" src="{{ url_for('static', filename='reports/images/accuracy_plot.png') }}" alt="Accuracy Plot">
</div>
<div class="section">
    <h2>Loss Over Epochs</h2>
    <img class="img-report" src="{{ url_for('static', filename='reports/images/loss_plot.png') }}" alt="Loss Plot">
</div>
<div class="section">
    <h2>Class Weights</h2>
    <table>
        <tr>
            <th>Class ID</th>
            <th>Class Name</th>
            <th>Weight</th>
        </tr>
        {% for class_id, weight in class_weights.items() %}
        {% set class_id_int = class_id | int %}
        <tr>
            <td>{{ class_id_int }}</td>
            <td>{{ class_names[class_id_int] }}</td>
            <td>{{ '{0:.2f}'.format(weight) }}</td>
        </tr>
    {% endfor %}
    </table>
</div>
<div class="section">
    <h2>Model Summary</h2>
    <iframe src="{{ url_for('static', filename='reports/model_summary.txt') }}" width="100%" height="350px" title="iframeModelSummary" style="border-width:0px"></iframe>
</div>

<!-- Include Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}